<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>PD3</title>

<script>
// https://bit.ly/e3289

let scriptId = 'AKfycbx1f7EFV2Au0C1Vw2Bb3vTqIuFVrw7w-PzzX53EZNOvD5um2LXafhWOsdQyEfp73N3eTA'; // 22 paren busca matr
//let scriptId = 'AKfycbwnqHTNi9B3pH5FYOp-UKvsAaEH1NFMbYJof487HSZWvyCuajuWH5ZYKuB9nR2JJ4kgQQ'; // 21 veeja

let auth2;
let googleUser;

let usuario = '';
let token = '';

function getCookie(cname) {
  let name = cname + "=";
  let ca = document.cookie.split(';');
  for(let i = 0; i < ca.length; i++) {
    let c = ca[i];
    while (c.charAt(0) == ' ') c = c.substring(1);
    if (c.indexOf(name) == 0) {
      return c.substring(name.length, c.length);
    }
  }
  return '';
}

token = getCookie('ceejapd');
usuario = getCookie('usuario');

if (token === '') {
  let s = document.createElement('script');
  s.src = 'https://apis.google.com/js/api:client.js';
  document.head.appendChild(s);
}

let startApp = () => {
  if (token === '') {
    gapi.load('auth2', initSignIn);
  }
  else {
    document.getElementById('customBtn').style.display = 'none';
    document.getElementById('bmail').style.display = 'block';
    document.getElementById('mail').innerText = usuario;
    window.location.href = `https://script.google.com/macros/s/${scriptId}/exec?usuario=${usuario}&token=${token}`;
    //window.location.href = `https://script.google.com/macros/s/AKfycbzqvJ8oZ05VhERVUOi93Jf8CSzrzsRfePJDkRxYe0ek/dev?usuario=${usuario}&token=${token}`;
  }
};

let initSignIn = () => {
  auth2 = gapi.auth2.init({client_id: '424899238646-9rov4v21n8936trraugrl3vcb3cs54id.apps.googleusercontent.com', scope:'profile email'});
  
  auth2.attachClickHandler(document.getElementById('customBtn'), {}, null, null);
  
  auth2.isSignedIn.listen(signinChanged);

  if (auth2.isSignedIn.get() == true) {
    auth2.signIn();
  }
};

let signinChanged = (val) => {
  if (val) {
    token = auth2.currentUser.get().getAuthResponse().id_token;
    usuario = auth2.currentUser.get().getBasicProfile().getEmail();
    
    document.getElementById('customBtn').style.display = 'none';
    document.getElementById('bmail').style.display = 'block';
    document.getElementById('mail').innerText = usuario;
    window.location.href = `https://script.google.com/macros/s/${scriptId}/exec?usuario=${usuario}&token=${token}`;
    //window.location.href = `https://script.google.com/macros/s/AKfycbzqvJ8oZ05VhERVUOi93Jf8CSzrzsRfePJDkRxYe0ek/dev?usuario=${usuario}&token=${token}`;
  }
  else {
    token = '';
    usuario = '';
    document.getElementById('bmail').style.display = 'none';
    document.getElementById('customBtn').style.display = 'inline';
  }
};

let sair = () => {
  document.cookie = 'ceejapd=;expires=1970-01-01T00:00:00.000Z;path=/ceejapd/;';
  document.cookie = 'usuario=;expires=1970-01-01T00:00:00.000Z;path=/ceejapd/;';
  if (auth2 == undefined) location.reload();
  else { auth2.signOut(); location.reload();}
};
</script>

<style>
body {
  height: 100%;
  background-color: #FFFFFF;
  font-family: 'Open Sans',sans-serif;
  color: #000000;
  font-size: 1em;
  line-height: 1.44em;
  text-align: justify;
  margin: 0em;
  padding: 1em;
}

#customBtn {
  display: inline-block;
  background: #1a73e8;
  color: #ffffff;
  border: 1px solid transparent;
  font-size: 1em;
  line-height: 1.44em;
  margin-left: 0.6em;
  margin-right: 0.5em;
  min-width: 6em;
  padding: 0.6em 1.44em;
  text-align: center;
  vertical-align: middle;
  -moz-border-radius: 0.25em;
  border-radius: 0.25em;
  box-sizing: border-box;
}

#customBtn:hover {
  cursor: pointer;
}
</style>
</head>

<body onload='startApp()'>
<p><img src="https://t7m8.com.br/img/selo.svg"></p>
<div id="customBtn" class="customBtn">Fazer login</div>
<p id="bmail" style="display:none">Usuário: <span id="mail" style='color:#DD4433'></span><br><br>
  <span onclick="sair();" style="background:#cccccc;border: 1px solid #000000; margin-left:0.6em; margin-right:0.5em; min-width:6em; padding: 0.56em 1.44em; text-align:center; vertical-align:middle; -moz-border-radius:0.25em; border-radius:0.25em; box-sizing: border-box; cursor:pointer;">Sair</span>
</p>

<br />
<br />
<br />
<br />

<p>Acesse nossas redes sociais:</p>

<p><a href="https://facebook.com/ceejapaulodecourt" target="_blank"><img src="https://github.com/tarcisomesquita/ceejapd/raw/4cb5b97fb0f430a98526060ead1263b660d94c23/imagens/facebook.png"> Facebook</a></p>

<p><a href="https://instagram.com/ceeja.paulo.decourt" target="_blank"><img src="https://github.com/tarcisomesquita/ceejapd/raw/4cb5b97fb0f430a98526060ead1263b660d94c23/imagens/instagran.png"> Instagram</a></p>

<p><a href="https://www.youtube.com/channel/UCaugpxhjj2F7aOfbG4k3TFQ/videos" target="_blank"><img src="https://raw.githubusercontent.com/tarcisomesquita/ceejapd/4cb5b97fb0f430a98526060ead1263b660d94c23/imagens/youtube.png"> Youtube</a></p>

<br />
<br />
<br />
<br />

<p><a href="https://t7m8.com.br/CEEJAs.php" target="_blank">Outros CEEJAs</a></p>

<footer style='font-family:"sans-serif"; font-size:0.63em;'>
<a href="https://tarcisomesquita.github.io/ceejapd/privacidade.html" target="_blank">Política de privacidade</a><br/>
Autor: <a href="https://t7m8.com.br/me.php" target="_blank">Tarciso Mesquita</a><br/>
<a rel="license" href="https://creativecommons.org/licenses/by/4.0/deed.pt_BR" target="_blank"><img alt="Licença Creative Commons" style="border-width:0" src="https://t7m8.com.br/img/CC-BY.png" /></a>
</footer>

</body>
</html>
