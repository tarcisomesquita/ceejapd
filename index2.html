<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta http-equiv='cache-control' content='no-cache'>
<meta name="google-site-verification" content="C40H-ZockeIOzCLX0YFj61hDmisnQJgoOENN-QbIh0k" />
<meta viewport='width=device-width'>

<title>CEEJA Paulo Decourt</title>

<!-- <script src="https://apis.google.com/js/api:client.js"></script> -->
<script>
var auth2;
var googleUser;
var token = '';
var usuario = '';
var avaliacao_p = '';
var matricula = '';
var disciplina = '';
var avaliacao = ''; 
var dia_i = '';
var dia_f = '';
var whatsapp_antigo = '';
var whatsapp_novo = '';
var email_antigo = '';
var email_novo = '';
var agenda_v = 'AKfycbw4eI9o3R-0lB4EL0ZfOBaKacUh_Mjc_NE98Q8g3AGCvxfdKqTqWvS4F2JIOU4sq2N3'; // 12
var avaliacao_geografia_ef = 'AKfycbxdCBVVf0o3lFuQT86-rplljz5nQevmGZBROVsVpzyEfYgw1pxhUegqPf6GfXuDEdICfw'; // credencial
var avaliacao_geografia = 'AKfycbyqoYKvHcSdbvmzA2YyWMkKV41EjgsN3aC4Po2-uHmCg58NvTQ-b-_ytVcgYAOzPoeZ'; // credencial
var avaliacao_filosofia = 'AKfycbxbLkZ35b7XITG2xTUfmcmwX--m9cod7ZYdu9SEjDqlj5uZzFupBvdc7zC22cdQ2AEZ7A'; // credencial
var avaliacao_sociologia = 'AKfycbwOgodobOj3eOHD8zo3BSyU5Wl60f-hsAwXm3jKDh6D6yErUDFQ3UYXJXEuDtMoHZO9'; // credencial
var avaliacao_biologia = 'AKfycbw5RzhS6fVRX6lSgQRqfJDo7eJYPv-qM9F4kmcLrTtmi2kNd-eqsx5UFTlD8iXlJig-Og'; // credencial
var avaliacao_quimica = 'AKfycbw4VW3TBXdt6xOgRxvIq071LzxEW6kkvJLf3L0KZIdUH-W_m85psU6ETAGTpHNkUB_zYw'; // credencial
var avaliacao_fisica = 'AKfycbxbfK69OZgogfdD1htiA1bKzutSkpnKC5qh0OXRuxFVLKMsTGk8BmzyQ7LSs8Vojnsf'; // credencial
var passaporte_v = 'AKfycbyYjoTXb8us5itHXnMt6RQZuswmIFwodtA8A5n_yWW2HqB-ayTV2tXdORHyKIFbvAWGuA'; // credencial
var atendimento_v = 'AKfycbyKKTNS-d5wx9grlacAHFJM7Oep6SzGeGlJ3JGPju5l1MlK6NomHsChYoLXhxvTAGnTdg'; // credencial
var boletim_v = 'AKfycbxxvEX2eLWROYhrz2cR_UPII4HkEmkUKMBIZAcgNDGo9z77BLPpMgfIFO6Q64ub9UMJ'; // credencial
var whatsapp_v = 'AKfycbwnk2Pc3vJESKDOs01QTpfvlNaKN2wqdh1s0ZJ-1PeFfDhk6QIhJCkpy78wPlTPKMhg'; // credencial
var email_v = 'AKfycby2n6SHByOSMQtfR8VdsfSO1pxpmu2MRVhgSiu1TFqQgiaumbylsx6-PWrF2SE8cPLu_w'; // credencial
var busca_matricula_v = 'AKfycbzC9KNoG6oYVy7nSBzVKNmS_cAuc_0x8EH-AJkIFMzJ-ghNKhLhNka578Qq9S-kcBS1'; // inicio
var boletim_file_v = 'AKfycbw791wnSKWm2bowxTL09ncbtmGSSi2u8KAF7HtthoW4YBWH3VsE5_IoWYpOES23tOMYWg'; // credencial
var requerimento_v = 'AKfycbw01a-ltp7zdlkYh0I2Qbzs0keon0-HANr0MFp2PgYGr0PA2NSpVK9TOpI1bzUDcjyY'; // credencial
//var requerimento_v = 'AKfycbwR9G5fBvkrs4LqzS5v1ZEY0Dh11sdXJOkINEpaH1P41i1aXkJdMcapqzKw0ifCSVFr'; // copia
var relatorio_v = 'AKfycbxL5pRkx_dH4BET8x4soS7_CWbbkA2QeqacQVENmiaugyOct4E63-DfXq2t4K6DDHfS'; // credencial
var historico_v = 'AKfycbyyS5mWwhxO1IxxVFOxTao2x4G0JSMrlToweeLqJmUrBTJZ6JSevVYQtumG1fgS6RzIBA'; // credencial
var resp_obj = {};
var resp_busca_mat_obj = {};

const avaliacoes_em = {
  "POR":['1A','1B','2A','2B','3A','3B','R'],
  "ING":['1A','1B','2A','2B','3A','3B','3C'],
  "ART":['1A','2A','3A','4A'],
  "MAT":['1A','1B','2A','2B','3A','3B'],
  "HIS":['1A','1B','2A','2B','3A','3B'],
  "GEO":['1A','2A','3A'],
  "FIL":['1A','1B','2A','2B','3A','3B'],
  "SOC":['1A','2A','3A'],
  "BIO":['1A','2A','3A','3B'],
  "QUI":['1A','2A','3A'],
  "FIS":['1A','1B','2A','2B','3A','3B']
};

const avaliacoes_ef = {
  "POR":['1A','1B','2A','2B','3A','3B','4A','4B','R'],
  "ING":['1A','2A','3A','4A','5A'],
  "ART":['1A','2A','3A','4A','5A'],
  "MAT":['1A','1B','2A','2B','3A','3B','4A','4B'],
  "HIS":['1A','2A','3A','4A'],
  "GEO":['1A','2A','3A','4A'],
  "CIE":['1A','2A','3A','4A','4B']
};


function informe(mensagem) {
  document.getElementById("texto").value = mensagem;
  document.forms.formlog2.submit();
}

function getCookie(cname) {
  let name = cname + "=";
  let ca = document.cookie.split(';');
  for(let i = 0; i < ca.length; i++) {
    let c = ca[i];
    while (c.charAt(0) == ' ') c = c.substring(1);
    if (c.indexOf(name) == 0) {
      return c.substring(name.length, c.length);
    }
  }
  return "";
}

token = getCookie("ceejapd");
usuario = getCookie("usuario");

console.log('usuario: ' + usuario + ' token: ' + token);
  
if (token === '') {
  let s = document.createElement('script');
  s.src = 'https://apis.google.com/js/api:client.js';
  document.head.appendChild(s);
}

function recarregar() {
  if (document.getElementById('customBtn').style.display != 'none') {
    //informe('recarregar: ' + usuario + ': aparelho: ' + navigator.userAgent.replace(/^[^(]+\(([^)]+)\).*$/,'$1'));
    location.reload();
  }
}
  
var startApp = function() {
  //informe('Cookie: ' + document.cookie + ' | aparelho: ' + navigator.userAgent);
  //setTimeout(recarregar, 20000);
  
  if (token === '') {
    gapi.load('auth2', initSignIn);
  }
  else {
    document.getElementById('customBtn').style.display = 'none';
    document.getElementById('bmail').style.display = 'block';
    document.getElementById('mail').innerText = usuario;
    //informe('login: ' + usuario + ' | aparelho: ' + navigator.userAgent.replace(/^[^(]+\(([^)]+)\).*$/,'$1'));
  }
};

var initSignIn = function() {
  auth2 = gapi.auth2.init({client_id: '424899238646-9rov4v21n8936trraugrl3vcb3cs54id.apps.googleusercontent.com', scope:'profile email'});
  
  auth2.attachClickHandler(document.getElementById('customBtn'), {}, null, null);
  
  auth2.isSignedIn.listen(signinChanged);

  if (auth2.isSignedIn.get() == true) {
    auth2.signIn(); // |  signOut()
  }
};

var signinChanged = function(val) {
  if (val) {
    token = auth2.currentUser.get().getAuthResponse().id_token;
    usuario = auth2.currentUser.get().getBasicProfile().getEmail();             // | getImageUrl() | getName()
    console.log('usuario: ' + usuario + ' token: ' + token);
    
    document.getElementById('customBtn').style.display = 'none';
    document.getElementById('bmail').style.display = 'block';
    document.getElementById('mail').innerText = usuario;
    //informe('login: ' + usuario + ' > aparelho: ' + navigator.userAgent.replace(/^[^(]+\(([^)]+)\).*$/,'$1'));
  }
  else {
    token = '';
    usuario = '';
    document.getElementById('bmail').style.display = 'none';
    document.getElementById('customBtn').style.display = 'inline';
  }
};

function sair() {
  //informe('logout: ' + usuario + ' | aparelho: ' + navigator.userAgent.replace(/^[^(]+\(([^)]+)\).*$/,'$1'));
  document.cookie = "ceejapd=;expires=1970-01-01T00:00:00.000Z;path=/ceejapd/;";
  document.cookie = "usuario=;expires=1970-01-01T00:00:00.000Z;path=/ceejapd/;";
  if (auth2 == undefined) location.reload();
  else { auth2.signOut(); location.reload();}
  //else window.location.href = "https://accounts.google.com/Logout";
  
  //auth2.signOut();
};




function avaliacao_fis(){
  if (token === '') {
    aviso('ERRO: Precisa fazer login.\n\nToque no botão azul na primeira linha.');
  }
  else {
    document.getElementById('container').style.display = 'inline';
    document.getElementById('avaliacao_id').style.display = 'inline';
    document.getElementById('avaliacao_matricula_id').focus();

    document.getElementById('avaliacao_matricula_id').setAttribute(
      'onkeydown',
      'if (event.keyCode == 13 && /[0-9]{6}/.test(avaliacao_matricula_id.value)){document.getElementById("avaliacao_avaliacao_id").focus()}'
    );
    
    document.getElementById('avaliacao_avaliacao_id').setAttribute(
      'onkeydown',
      'if (event.keyCode == 13){document.getElementById("avaliacao_button_id").focus()}'
    );

    document.getElementById('avaliacao_button_id').setAttribute(
      'onclick',
      'if (/[0-9]{6}/.test(avaliacao_matricula_id.value)){matricula = document.getElementById("avaliacao_matricula_id").value; avaliacao_p = document.getElementById("avaliacao_avaliacao_id").value; avaliacao_fis_b()}'
    );
  }
}

function avaliacao_fis_b() {
  document.getElementById('page').innerHTML = '<p class="erro">Aguarde 1 minuto. Gerando arquivo...</p>';
  document.getElementById('page').style.cursor = 'wait';
  
  let s = document.createElement('script');
  s.src = 'https://script.google.com/macros/s/' + avaliacao_fisica + '/exec?matricula=' + matricula + '&avaliacao=' + avaliacao_p + '&usuario=' + usuario + '&token=' + token;
  s.onerror = function () {
    document.getElementById('page').innerHTML = '<p class="erro">ERRO ao carregar. Informe o professor.</p>';
    informe('ERRO: ceejapd: load avaliacao FIS ' + usuario);
  };
  document.body.appendChild(s);
}

function avaliacao_fil() {
  if (token === '') {
    aviso('ERRO: Precisa fazer login.\n\nToque no botão azul na primeira linha.');
  }
  else {
    document.getElementById('container').style.display = 'inline';
    document.getElementById('avaliacao_id').style.display = 'inline';
    document.getElementById('avaliacao_matricula_id').focus();
    
    document.getElementById('avaliacao_matricula_id').setAttribute(
      'onkeydown',
      'if (event.keyCode == 13 && /[0-9]{6}/.test(avaliacao_matricula_id.value)){document.getElementById("avaliacao_avaliacao_id").focus()}'
    );
    
    document.getElementById('avaliacao_avaliacao_id').setAttribute(
      'onkeydown',
      'if (event.keyCode == 13){document.getElementById("avaliacao_button_id").focus()}'
    );
    
    document.getElementById('avaliacao_button_id').setAttribute(
      'onclick',
      'if (/[0-9]{6}/.test(avaliacao_matricula_id.value)){matricula = document.getElementById("avaliacao_matricula_id").value; avaliacao_p = document.getElementById("avaliacao_avaliacao_id").value; avaliacao_fil_b()}'
    );
  }
}

function avaliacao_fil_b() {
  document.getElementById('page').innerHTML = '<p class="erro">Aguarde 1 minuto. Gerando arquivo...</p>';
  document.getElementById('page').style.cursor = 'wait';
  
  let s = document.createElement('script');
  s.src = 'https://script.google.com/macros/s/' + avaliacao_filosofia + '/exec?matricula=' + matricula + '&avaliacao=' + avaliacao_p + '&usuario=' + usuario + '&token=' + token;
  s.onerror = function () {
    document.getElementById('page').innerHTML = '<p class="erro">ERRO ao carregar. Informe o professor.</p>';
    informe('ERRO: ceejapd: load avaliacao FIL ' + usuario);
  };
  document.body.appendChild(s);
}

function avaliacao_geo() {
  if (token === '') {
    aviso('ERRO: Precisa fazer login.\n\nToque no botão azul na primeira linha.');
  }
  else {
    document.getElementById('container').style.display = 'inline';
    document.getElementById('avaliacao_a_id').style.display = 'inline';
    document.getElementById('avaliacao_a_matricula_id').focus();

    document.getElementById('avaliacao_a_matricula_id').setAttribute(
      'onkeydown',
      'if (event.keyCode == 13 && /[0-9]{6}/.test(avaliacao_a_matricula_id.value)){document.getElementById("avaliacao_a_avaliacao_id").focus()}'
    );
    
    document.getElementById('avaliacao_a_avaliacao_id').setAttribute(
      'onkeydown',
      'if (event.keyCode == 13){document.getElementById("avaliacao_a_button_id").focus()}'
    );

    document.getElementById('avaliacao_a_button_id').setAttribute(
      'onclick',
      'if (/[0-9]{6}/.test(avaliacao_a_matricula_id.value)){matricula = document.getElementById("avaliacao_a_matricula_id").value; avaliacao_p = document.getElementById("avaliacao_a_avaliacao_id").value; avaliacao_geo_b()}'
    );
  }
}

function avaliacao_geo_b() {
  document.getElementById('page').innerHTML = '<p class="erro">Aguarde 1 minuto. Gerando arquivo...</p>';
  document.getElementById('page').style.cursor = 'wait';
  
  let s = document.createElement('script');
  s.src = 'https://script.google.com/macros/s/' + avaliacao_geografia + '/exec?matricula=' + matricula + '&avaliacao=' + avaliacao_p + '&usuario=' + usuario + '&token=' + token;
  s.onerror = function () {
    document.getElementById('page').innerHTML = '<p class="erro">ERRO ao carregar. Informe o professor.</p>';
    informe('ERRO: ceejapd: load avaliacao GEO EM ' + usuario);
  };
  document.body.appendChild(s);
}

function avaliacao_geo_ef() {
  if (token === '') {
    aviso('ERRO: Precisa fazer login.\n\nToque no botão azul na primeira linha.');
  }
  else {
    document.getElementById('container').style.display = 'inline';
    document.getElementById('avaliacao_a_ef_id').style.display = 'inline';
    document.getElementById('avaliacao_a_ef_matricula_id').focus();

    document.getElementById('avaliacao_a_ef_matricula_id').setAttribute(
      'onkeydown',
      'if (event.keyCode == 13 && /[0-9]{6}/.test(avaliacao_a_ef_matricula_id.value)){document.getElementById("avaliacao_a_ef_avaliacao_id").focus()}'
    );
    
    document.getElementById('avaliacao_a_ef_avaliacao_id').setAttribute(
      'onkeydown',
      'if (event.keyCode == 13){document.getElementById("avaliacao_a_ef_button_id").focus()}'
    );

    document.getElementById('avaliacao_a_ef_button_id').setAttribute(
      'onclick',
      'if (/[0-9]{6}/.test(avaliacao_a_ef_matricula_id.value)){matricula = document.getElementById("avaliacao_a_ef_matricula_id").value; avaliacao_p = document.getElementById("avaliacao_a_ef_avaliacao_id").value; avaliacao_geo_ef_b()}'
    );
  }
}

function avaliacao_geo_ef_b() {
  document.getElementById('page').innerHTML = '<p class="erro">Aguarde 1 minuto. Gerando arquivo...</p>';
  document.getElementById('page').style.cursor = 'wait';
  
  let s = document.createElement('script');
  s.src = 'https://script.google.com/macros/s/' + avaliacao_geografia_ef + '/exec?matricula=' + matricula + '&avaliacao=' + avaliacao_p + '&usuario=' + usuario + '&token=' + token;
  s.onerror = function () {
    document.getElementById('page').innerHTML = '<p class="erro">ERRO ao carregar. Informe o professor.</p>';
    informe('ERRO: ceejapd: load avaliacao GEO EF ' + usuario);
  };
  document.body.appendChild(s);
}

function avaliacao_bio() {
  if (token === '') {
    aviso('ERRO: Precisa fazer login.\n\nToque no botão azul na primeira linha.');
  }
  else {
    document.getElementById('container').style.display = 'inline';
    document.getElementById('avaliacao_a_id').style.display = 'inline';
    document.getElementById('avaliacao_a_matricula_id').focus();

    document.getElementById('avaliacao_a_matricula_id').setAttribute(
      'onkeydown',
      'if (event.keyCode == 13 && /[0-9]{6}/.test(avaliacao_a_matricula_id.value)){document.getElementById("avaliacao_a_avaliacao_id").focus()}'
    );
    
    document.getElementById('avaliacao_a_avaliacao_id').setAttribute(
      'onkeydown',
      'if (event.keyCode == 13){document.getElementById("avaliacao_a_button_id").focus()}'
    );

    document.getElementById('avaliacao_a_button_id').setAttribute(
      'onclick',
      'if (/[0-9]{6}/.test(avaliacao_a_matricula_id.value)){matricula = document.getElementById("avaliacao_a_matricula_id").value; avaliacao_p = document.getElementById("avaliacao_a_avaliacao_id").value; avaliacao_bio_b()}'
    );
  }
}

function avaliacao_bio_b() {
  document.getElementById('page').innerHTML = '<p class="erro">Aguarde 1 minuto. Gerando arquivo...</p>';
  document.getElementById('page').style.cursor = 'wait';
  
  let s = document.createElement('script');
  s.src = 'https://script.google.com/macros/s/' + avaliacao_biologia + '/exec?matricula=' + matricula + '&avaliacao=' + avaliacao_p + '&usuario=' + usuario + '&token=' + token;
  s.onerror = function () {
    document.getElementById('page').innerHTML = '<p class="erro">ERRO ao carregar. Informe o professor.</p>';
    informe('ERRO: ceejapd: load avaliacao BIO ' + usuario);
  };
  document.body.appendChild(s);
}

function avaliacao_soc() {
  if (token === '') {
    aviso('ERRO: Precisa fazer login.\n\nToque no botão azul na primeira linha.');
  }
  else {
     document.getElementById('container').style.display = 'inline';
    document.getElementById('avaliacao_a_id').style.display = 'inline';
    document.getElementById('avaliacao_a_matricula_id').focus();

    document.getElementById('avaliacao_a_matricula_id').setAttribute(
      'onkeydown',
      'if (event.keyCode == 13 && /[0-9]{6}/.test(avaliacao_a_matricula_id.value)){document.getElementById("avaliacao_a_avaliacao_id").focus()}'
    );
    
    document.getElementById('avaliacao_a_avaliacao_id').setAttribute(
      'onkeydown',
      'if (event.keyCode == 13){document.getElementById("avaliacao_a_button_id").focus()}'
    );

    document.getElementById('avaliacao_a_button_id').setAttribute(
      'onclick',
      'if (/[0-9]{6}/.test(avaliacao_a_matricula_id.value)){matricula = document.getElementById("avaliacao_a_matricula_id").value; avaliacao_p = document.getElementById("avaliacao_a_avaliacao_id").value; avaliacao_soc_b()}'
    );
  }
}

function avaliacao_soc_b() {
  document.getElementById('page').innerHTML = '<p class="erro">Aguarde 1 minuto. Gerando arquivo...</p>';
  document.getElementById('page').style.cursor = 'wait';
  
  let s = document.createElement('script');
  s.src = 'https://script.google.com/macros/s/' + avaliacao_sociologia + '/exec?matricula=' + matricula + '&avaliacao=' + avaliacao_p + '&usuario=' + usuario + '&token=' + token;
  s.onerror = function () {
    document.getElementById('page').innerHTML = '<p class="erro">ERRO ao carregar. Informe o professor.</p>';
    informe('ERRO: ceejapd: load avaliacao SOC ' + usuario);
  };
  document.body.appendChild(s);
}

function avaliacao_qui() {
  if (token === '') {
    aviso('ERRO: Precisa fazer login.\n\nToque no botão azul na primeira linha.');
  }
  else {
    document.getElementById('container').style.display = 'inline';
    document.getElementById('avaliacao_a_id').style.display = 'inline';
    document.getElementById('avaliacao_a_matricula_id').focus();

    document.getElementById('avaliacao_a_matricula_id').setAttribute(
      'onkeydown',
      'if (event.keyCode == 13 && /[0-9]{6}/.test(avaliacao_a_matricula_id.value)){document.getElementById("avaliacao_a_avaliacao_id").focus()}'
    );
    
    document.getElementById('avaliacao_a_avaliacao_id').setAttribute(
      'onkeydown',
      'if (event.keyCode == 13){document.getElementById("avaliacao_a_button_id").focus()}'
    );

    document.getElementById('avaliacao_a_button_id').setAttribute(
      'onclick',
      'if (/[0-9]{6}/.test(avaliacao_a_matricula_id.value)){matricula = document.getElementById("avaliacao_a_matricula_id").value; avaliacao_p = document.getElementById("avaliacao_a_avaliacao_id").value; avaliacao_qui_b()}'
    );
  }
}

function avaliacao_qui_b() {
  document.getElementById('page').innerHTML = '<p class="erro">Aguarde 1 minuto. Gerando arquivo...</p>';
  document.getElementById('page').style.cursor = 'wait';
  
  let s = document.createElement('script');
  s.src = 'https://script.google.com/macros/s/' + avaliacao_quimica + '/exec?matricula=' + matricula + '&avaliacao=' + avaliacao_p + '&usuario=' + usuario + '&token=' + token;
  s.onerror = function () {
    document.getElementById('page').innerHTML = '<p class="erro">ERRO ao carregar. Informe o professor.</p>';
    informe('ERRO: ceejapd: load avaliacao QUI ' + usuario);
  };
  document.body.appendChild(s);
}

function passaporte(){
  if (token === '') {
    aviso('ERRO: Precisa fazer login.\n\nToque no botão azul na primeira linha.');
  }
  else {
    document.getElementById('container').style.display = 'inline';
    document.getElementById('box').style.display = 'inline';
    document.getElementById('matricula_id').focus();
    
    document.getElementById('matricula_id').setAttribute(
      'onkeydown',
      'if (event.keyCode == 13 && /[0-9]{6}/.test(matricula_id.value)){document.getElementById("matricula_button").focus();}'
    );
      
    document.getElementById('matricula_button').setAttribute(
      'onclick',
      'if (/[0-9]{6}/.test(matricula_id.value)){matricula = document.getElementById("matricula_id").value; passaporte_b()}'
    );
  }
}

function passaporte_b() {
  document.getElementById('page').innerHTML = '<p class="erro">Aguarde 1 minuto. Gerando arquivo...</p>';
  document.getElementById('page').style.cursor = 'wait';
  
  let s = document.createElement('script');
  s.src = 'https://script.google.com/macros/s/' + passaporte_v + '/exec?matricula=' + matricula + '&usuario=' + usuario + '&token=' + token;
  s.onerror = function () {
    document.getElementById('page').innerHTML = '<p class="erro">ERRO ao carregar. Informe o professor.</p>';
    informe('ERRO: ceejapd: load passaporte ' + usuario);
  };
  document.body.appendChild(s);
}

function atendimento(){
  if (token === '') {
    aviso('ERRO: Precisa fazer login.\n\nToque no botão azul na primeira linha.');
  }
  else {
    document.getElementById('page').innerHTML = '<p class="erro">Aguarde 1 minuto. Gerando arquivo...</p>';
    document.getElementById('page').style.cursor = 'wait';
    
    let s = document.createElement('script');
    s.src = 'https://script.google.com/macros/s/' + atendimento_v + '/exec?usuario=' + usuario + '&token=' + token;
    s.onerror = function () {
      document.getElementById('page').innerHTML = '<p class="erro">ERRO ao carregar. Informe o professor.</p>';
      informe('ERRO: ceejapd: load atendimento ' + usuario);
    };
    document.body.appendChild(s);
  }
}

function boletim(){
  if (token === '') {
    aviso('ERRO: Precisa fazer login.\n\nToque no botão azul na primeira linha.');
  }
  else {
    document.getElementById('container').style.display = 'inline';
    document.getElementById('box').style.display = 'inline';
    document.getElementById('matricula_id').focus();
    
    document.getElementById('matricula_id').setAttribute(
      'onkeydown',
      'if (event.keyCode == 13 && /[0-9]{6}/.test(matricula_id.value)){document.getElementById("matricula_button").focus()}'
    );
      
    document.getElementById('matricula_button').setAttribute(
      'onclick',
      'if (/[0-9]{6}/.test(matricula_id.value)){matricula = document.getElementById("matricula_id").value; boletim_b()}'
    );
  }
}

function boletim_b() {
  document.getElementById('page').innerHTML = '<p class="erro">Aguarde 1 minuto. Gerando arquivo...</p>';
  document.getElementById('page').style.cursor = 'wait';
  
  let s = document.createElement('script');
  s.src = 'https://script.google.com/macros/s/' + boletim_v + '/exec?matricula=' + matricula + '&usuario=' + usuario + '&token=' + token;
  s.onerror = function () {
    document.getElementById('page').innerHTML = '<p class="erro">ERRO ao carregar. Informe o professor.</p>';
    informe('ERRO: ceejapd: load boletim ' + usuario);
  };
  document.body.appendChild(s);
  //informe(navigator.userAgent);
}

function whatsapp(){
  if (token === '') {
    aviso('ERRO: Precisa fazer login.\n\nToque no botão azul na primeira linha.');
  }
  else {
    document.getElementById('container').style.display = 'inline';
    document.getElementById('box').style.display = 'inline';
    document.getElementById('matricula_id').focus();
    
    document.getElementById('matricula_id').setAttribute(
      'onkeydown',
      'if (event.keyCode == 13 && /[0-9]{6}/.test(matricula_id.value)){document.getElementById("matricula_button").focus()}'
    );
      
    document.getElementById('matricula_button').setAttribute(
      'onclick',
      'if (/[0-9]{6}/.test(matricula_id.value)){matricula = document.getElementById("matricula_id").value; whatsapp_b()}'
    );
  }
}

function whatsapp_b() {
  document.getElementById('container').style.display = 'inline';
  document.getElementById('whatsapp_id').style.display = 'inline';
  document.getElementById('whatsapp_antigo_id').focus();
  
  document.getElementById('whatsapp_antigo_id').setAttribute(
    'onkeydown',
    'if (event.keyCode == 13 && /\\([0-9]{2}\\)[0-9]\\.[0-9]{4}-[0-9]{4}/.test(whatsapp_antigo_id.value)){document.getElementById("whatsapp_novo_id").focus();}'
  );
  
  document.getElementById('whatsapp_novo_id').setAttribute(
    'onkeydown',
    'if (event.keyCode == 13 && /\\([0-9]{2}\\)[0-9]\\.[0-9]{4}-[0-9]{4}/.test(whatsapp_novo_id.value)){document.getElementById("whatsapp_button").focus();}'
  );
   
  document.getElementById('whatsapp_button').setAttribute(
    'onclick',
    'if (/\\([0-9]{2}\\)[0-9]\\.[0-9]{4}-[0-9]{4}/.test(whatsapp_antigo_id.value) && /\\([0-9]{2}\\)[0-9]\\.[0-9]{4}-[0-9]{4}/.test(whatsapp_novo_id.value)){ whatsapp_antigo = escape(document.getElementById("whatsapp_antigo_id").value); whatsapp_novo = escape(document.getElementById("whatsapp_novo_id").value); whatsapp_c()}'
  );
}

function whatsapp_c() {
  document.getElementById('page').innerHTML = '<p class="erro">Aguarde 1 minuto. Atualizando...</p>';
  document.getElementById('page').style.cursor = 'wait';
  
  let s = document.createElement('script');
  s.src = 'https://script.google.com/macros/s/' + whatsapp_v + '/exec?matricula=' + matricula + '&whatsapp_antigo=' + whatsapp_antigo + '&whatsapp_novo=' + whatsapp_novo + '&usuario=' + usuario + '&token=' + token;
  s.onerror = function () {
    document.getElementById('page').innerHTML = '<p class="erro">ERRO ao carregar. Informe o professor.</p>';
    informe('ERRO: ceejapd: load whatsapp ' + usuario);
  };
  document.body.appendChild(s);
}

function email(){
  if (token === '') {
    aviso('ERRO: Precisa fazer login.\n\nToque no botão azul na primeira linha.');
  }
  else {
    document.getElementById('container').style.display = 'inline';
    document.getElementById('box').style.display = 'inline';
    document.getElementById('matricula_id').focus();
    
    document.getElementById('matricula_id').setAttribute(
      'onkeydown',
      'if (event.keyCode == 13 && /[0-9]{6}/.test(matricula_id.value)){document.getElementById("matricula_button").focus()}'
    );
      
    document.getElementById('matricula_button').setAttribute(
      'onclick',
      'if (/[0-9]{6}/.test(matricula_id.value)){matricula = document.getElementById("matricula_id").value; email_b()}'
    );
  }
}

function email_b() {
  document.getElementById('container').style.display = 'inline';
  document.getElementById('email_id').style.display = 'inline';
  document.getElementById('email_antigo_id').focus();
  
  document.getElementById('email_antigo_id').setAttribute(
    'onkeydown',
    'if (event.keyCode == 13){document.getElementById("email_novo_id").focus();}'
  );
  
  document.getElementById('email_novo_id').setAttribute(
    'onkeydown',
    'if (event.keyCode == 13){document.getElementById("email_button").focus();}'
  );
   
  document.getElementById('email_button').setAttribute(
    'onclick',
    'email_antigo = escape(document.getElementById("email_antigo_id").value); email_novo = escape(document.getElementById("email_novo_id").value); email_c();'
  );
}

function email_c() {
  document.getElementById('page').innerHTML = '<p class="erro">Aguarde 1 minuto. Atualizando...</p>';
  document.getElementById('page').style.cursor = 'wait';
  
  let s = document.createElement('script');
  s.src = 'https://script.google.com/macros/s/' + email_v + '/exec?matricula=' + matricula + '&email_antigo=' + email_antigo + '&email_novo=' + email_novo + '&usuario=' + usuario + '&token=' + token;
  s.onerror = function () {
    document.getElementById('page').innerHTML = '<p class="erro">ERRO ao carregar. Informe o professor.</p>';
    informe('ERRO: ceejapd: load email: ' + usuario + ': ' + matricula + ': ' + email_antigo + ': ' + email_novo);
  };
  document.body.appendChild(s);
}

function requerimento(){
  if (token === '') {
    aviso('ERRO: Precisa fazer login.\n\nToque no botão azul na primeira linha.');
  }
  else {
    document.getElementById('container').style.display = 'inline';
    document.getElementById('box').style.display = 'inline';
    document.getElementById('matricula_id').focus();
    
    document.getElementById('matricula_id').setAttribute(
      'onkeydown',
      'if (event.keyCode == 13 && /[0-9]{6}/.test(matricula_id.value)){document.getElementById("matricula_button").focus()}'
    );
      
    document.getElementById('matricula_button').setAttribute(
      'onclick',
      'if (/[0-9]{6}/.test(matricula_id.value)){matricula = document.getElementById("matricula_id").value; requerimento_b()}'
    );
  }
}

function requerimento_b() {
  document.getElementById('page').innerHTML = '<p class="erro">Aguarde 1 minuto. Gerando arquivo...</p>';
  document.getElementById('page').style.cursor = 'wait';
  
  let s = document.createElement('script');
  s.src = 'https://script.google.com/macros/s/' + requerimento_v + '/exec?matricula=' + matricula + '&usuario=' + usuario + '&token=' + token;
  s.onerror = function () {
    document.getElementById('page').innerHTML = '<p class="erro">ERRO ao carregar. Informe o professor.</p>';
    informe('ERRO: ceejapd: load requerimento: ' + usuario + ': ' + matricula);
  };
  document.body.appendChild(s);
}

function boletim_file(){
  if (token === '') {
    aviso('ERRO: Precisa fazer login.\n\nToque no botão azul na primeira linha.');
  }
  else {
    document.getElementById('container').style.display = 'inline';
    document.getElementById('dia_id').style.display = 'inline';
    document.getElementById('dia_i_id').focus();
    
    document.getElementById('dia_i_id').setAttribute(
      'onkeydown',
      'if (event.keyCode == 13 && /[0-9]{2}\\/[0-9]{2}\\/[0-9]{4}/.test(dia_i_id.value)){document.getElementById("dia_f_id").focus();}'
    );

    document.getElementById('dia_f_id').setAttribute(
      'onkeydown',
      'if (event.keyCode == 13 && /[0-9]{2}\\/[0-9]{2}\\/[0-9]{4}/.test(dia_f_id.value)){document.getElementById("dia_button").focus();}'
    );
      
    document.getElementById('dia_button').setAttribute(
      'onclick',
      'if (/[0-9]{2}\\/[0-9]{2}\\/[0-9]{4}/.test(dia_i_id.value) && /[0-9]{2}\\/[0-9]{2}\\/[0-9]{4}/.test(dia_f_id.value)){dia_i = document.getElementById("dia_i_id").value.replace(/\\//g,""); dia_f = document.getElementById("dia_f_id").value.replace(/\\//g,""); boletim_file_b()}'
    );
  }
}

function boletim_file_b() {
  document.getElementById('page').innerHTML = '<p class="erro">Aguarde 1 minuto. Gerando arquivo...</p>';
  document.getElementById('page').style.cursor = 'wait';
  
  let s = document.createElement('script');
  s.src = 'https://script.google.com/macros/s/' + boletim_file_v + '/exec?dia_i=' + dia_i + '&dia_f=' + dia_f + '&usuario=' + usuario + '&token=' + token;
  s.onerror = function () {
    document.getElementById('page').innerHTML = '<p class="erro">ERRO ao carregar. Informe o professor.</p>';
    informe('ERRO: ceejapd: load boletim_file ' + usuario);
  };
  document.body.appendChild(s);
}

function historico(){
  if (token === '') {
    aviso('ERRO: Precisa fazer login.\n\nToque no botão azul na primeira linha.');
  }
  else {
    document.getElementById('container').style.display = 'inline';
    document.getElementById('box').style.display = 'inline';
    document.getElementById('matricula_id').focus();
    
    document.getElementById('matricula_id').setAttribute(
      'onkeydown',
      'if (event.keyCode == 13 && /[0-9]{6}/.test(matricula_id.value)){document.getElementById("matricula_button").focus()}'
    );
      
    document.getElementById('matricula_button').setAttribute(
      'onclick',
      'if (/[0-9]{6}/.test(matricula_id.value)){matricula = document.getElementById("matricula_id").value; historico_b()}'
    );
  }
}

function historico_b() {
  document.getElementById('page').innerHTML = '<p class="erro">Aguarde 1 minuto. Gerando arquivo...</p>';
  document.getElementById('page').style.cursor = 'wait';
  
  let s = document.createElement('script');
  s.src = 'https://script.google.com/macros/s/' + historico_v + '/exec?matricula=' + matricula + '&usuario=' + usuario + '&token=' + token;
  s.onerror = function () {
    document.getElementById('page').innerHTML = '<p class="erro">ERRO ao carregar. Informe o professor.</p>';
    informe('ERRO: ceejapd: load historico ' + usuario);
  };
  document.body.appendChild(s);
}

function relatorio(){
  if (token === '') {
    aviso('ERRO: Precisa fazer login.\n\nToque no botão azul na primeira linha.');
  }
  else {
    document.getElementById('page').innerHTML = '<p class="erro">Aguarde 1 minuto. Gerando arquivo...</p>';
    document.getElementById('page').style.cursor = 'wait';
    
    let s = document.createElement('script');
    s.src = 'https://script.google.com/macros/s/' + relatorio_v + '/exec?usuario=' + usuario + '&token=' + token;
    s.onerror = function () {
      document.getElementById('page').innerHTML = '<p class="erro">ERRO ao carregar. Informe o professor.</p>';
      informe('ERRO: ceejapd: load relatorio ' + usuario);
    };
    document.body.appendChild(s);
  }
}

function aviso(mensagem) {
  document.getElementById('container').style.display = 'inline';
  document.getElementById('aviso').style.display = 'inline';
  document.getElementById('mensagem').innerText = mensagem;
  document.getElementById('aviso_button').focus();
}

function aviso_b() {
  document.getElementById('container').style.display = 'none';
  document.getElementById('aviso').style.display = 'none';
}
</script>

<style>
body {
  height: 100%;
  background-color: #FFFFFF;
  font-family: 'Open Sans',sans-serif;
  color: #000000;
  font-size: 16px;
  line-height: 23px;
  text-align: justify;
  margin: 0px;
  padding: 5mm;
}

h1 {
  text-align: center;
}

a:link    {color:#2160DE; text-decoration:none;}      /* unvisited link  */
a:visited {color:#2160DE; text-decoration:none;}      /* visited link    */
a:hover   {color:#2160DE; text-decoration:underline;} /* mouse over link */
a:active  {color:#2160DE; text-decoration:underline;} /* selected link   */

pre {
  color: #000000;
}

.erro {
  text-align: center;
  font-size: 14pt;
  line-height: 20pt;
  font-weight: bold;
  
  margin: 0px;
  padding-top: 2cm;
  padding-bottom: 2cm;
  width: 100vw;
  background-color: #FFFF77;
  position: fixed;
  top: 30px;
}

.link {
  cursor:pointer
}

.link:hover, .link:active {
  text-decoration:underline;
}

#customBtn {
  display: inline-block;
  background: #1a73e8;
  color: #ffffff;
  border: 1px solid transparent;
  font-size: 16px;
  line-height: 23px;
  margin-left: 10px;
  margin-right: 8px;
  min-width: 96px;
  padding: 9px 23px;
  text-align: center;
  vertical-align: middle;
  -moz-border-radius: 4px;
  border-radius: 4px;
  box-sizing: border-box;
}

#customBtn:hover {
  cursor: pointer;
}

.container {
  display: none;
  position: fixed;
  top: 0px;
  left: 0px;
  width: 100vw;
  height: 100vh;
  background: #6C7A89;
  opacity: 0.5;
}

.box {
  display: none;
  position: fixed;
  top: 5%;
  left: 30%;
  background: #bbeeff;
  opacity: 1;
  padding: 30px;
  border: 2px solid #AAAAAA;
  text-align: center;
}

table, td, th {
  border: 1px solid black;
}

table { 
  border-collapse: collapse;
}
</style>

</head>

<body onload='startApp()'>

<div id="page">

<br />

<div id="customBtn" class="customBtn">Fazer login</div>
<p id="bmail" style="display:none">Usuário: <span id="mail" style='color:#DD4433'></span>
  <span onclick="sair();" style="background:#cccccc;border: 1px solid #000000; margin-left:10px; margin-right:8px; min-width:96px; padding: 9px 23px; text-align:center; vertical-align:middle; -moz-border-radius:4px; border-radius:4px; box-sizing: border-box; cursor:pointer;">Sair</span>
</p>

<br />

<p id="agenda" class='link' style='color:#22BB22'>Agendar atendimento presencial</a></p>
 
<p><a href="https://youtube.com/channel/UCxd2y8b5DYrjH4yTHOwzxKg/videos">Dicas no Youtube</a></p>

<p><a href="https://bit.ly/ceejaonline">Drive Livros</a></p>

<div id="avaliacoes">
<p onclick="avaliacao_geo_ef()" class='link' style='color:#22BB22'>Pegar avaliação de Geografia - Ensino Fundamental</p>

<p onclick="avaliacao_geo()" class='link' style='color:#22BB22'>Pegar avaliação de Geografia - Ensino Médio</p>

<p onclick="avaliacao_soc()" class='link' style='color:#22BB22'>Pegar avaliação de Sociologia</p>

<p onclick="avaliacao_fil()" class='link' style='color:#22BB22'>Pegar avaliação de Filosofia</p>

<p onclick="avaliacao_bio()" class='link' style='color:#22BB22'>Pegar avaliação de Biologia</p>

<p onclick="avaliacao_qui()" class='link' style='color:#22BB22'>Pegar avaliação de Química</p>

<p onclick="avaliacao_fis()" class='link' style='color:#22BB22'>Pegar avaliação de Física</p>
</div> <!--  id="avaliacoes" -->
<br>

<p onclick="passaporte()" class='link' style='color:#22BB22'>Ver notas (passaporte)</p>

<br>

<p id='busca_matricula' class='link' style='color:#22BB22'>Consultar número de matrícula</p>

<br>

<p><a href="https://bit.ly/escolapaulo">Formulário de matrícula</a></p>

<p><a href="https://www.google.com/maps/dir//-22.856400368690867,-47.04246102053969/">Rota para CEEJA Paulo Decourt</a></p>

<br />

<p onclick="atendimento()" class='link' style='color:#DD6611'>Registros de atendimento</p>

<p onclick="boletim()" class='link' style='color:#DD6611'>Gerar boletim</p>

<p onclick="whatsapp()" class='link' style='color:#DD6611'>Atualizar WhatsApp</p>

<p onclick="email()" class='link' style='color:#DD6611'>Atualizar email</p>

<br />

<p><a href="https://drive.google.com/drive/folders/18TxnjlmMWt7-ifq5xqS5ZYed9iPCggs7" style='color:#AA33AA'>Drive Secretaria</a></p>

<p onclick="requerimento()" class='link' style='color:#DD4433'>Requerimento de matrícula</a></p>

<p onclick="boletim_file()" class='link' style='color:#DD4433'>Boletins para imprimir</a></p>

<p onclick="relatorio()" class='link' style='color:#DD4433'>Relatório anual</a></p>

<!--<p onclick="historico()" class='link' style='color:#DD4433'>Gerar histórico</a></p>-->

<!--<p onclick="permissoes()" class='link' style='color:#DD4433'>Atualizar permissões</a></p>-->

<br />

<p><a href="https://facebook.com/ceejapaulodecourt">facebook</a></p>

<p><a href="https://instagram.com/ceeja.paulo.decourt">instagram</a></p>

<p><a href="https://www.youtube.com/channel/UCaugpxhjj2F7aOfbG4k3TFQ/videos">youtube</a></p>

<br />

<p><a href='https://tarcisomesquita.github.io/ceejapd/CEEJAs.html'>Outros CEEJAs</a></p>

<p><a href='https://youtu.be/VV_uiMx9w9g'>Ver para entender nosso trabalho</a></p>

<p><a href='https://drive.google.com/file/d/1NSeMUiFj0dSbl78aTJEbaK4Fv8vfNlnO/view?usp=sharing'>Orientação pedagógica para CEEJA</a></p>

<br />

<div id='container' class='container'>
</div>
<div id='box' class='box'>
  <p>Digite o número da matrícula:</p>
  <input 
    id="matricula_id" 
    type="text" 
    pattern="[0-9]{6}" 
    maxlength="6" 
    style="margin:5px"
  >
  <input 
    id="matricula_button" 
    type="button" 
    value="ok" 
  >
</div>

<div id='avaliacao_id' class='box' style='text-align: left'>
  <p>matrícula:<input 
    id="avaliacao_matricula_id" 
    type="text" 
    pattern="[0-9]{6}" 
    maxlength="6" 
    style="margin:5px"
  ></p>
  <p>avaliação: <select id='avaliacao_avaliacao_id' style='margin:5px'>
    <option value='1A'>1A</option>
    <option value='1B'>1B</option>
    <option value='2A'>2A</option>
    <option value='2B'>2B</option>
    <option value='3A'>3A</option>
    <option value='3B'>3B</option>
  </select></p>
  <p>visualizar:<input 
    id="avaliacao_button_id" 
    type="button" 
    value="ok" 
    style='margin:5px'
  ></p>
  <p>Terá <span style='color:#ff0000; font-weight:bold'>2 horas</span> para fazer</p>
</div>


<div id='avaliacao_a_id' class='box' style='text-align: left'>
  <p>matrícula:<input 
    id="avaliacao_a_matricula_id" 
    type="text" 
    pattern="[0-9]{6}" 
    maxlength="6" 
    style="margin:5px"
  ></p>
  <p>avaliação: <select id='avaliacao_a_avaliacao_id' style='margin:5px'>
    <option value='1A'>1A</option>
    <option value='2A'>2A</option>
    <option value='3A'>3A</option>
  </select></p>
  <p>visualizar:<input 
    id="avaliacao_a_button_id" 
    type="button" 
    value="ok" 
    style='margin:5px'
  ></p>
  <p>Terá <span style='color:#ff0000; font-weight:bold'>2 horas</span> para fazer</p>
</div>

<div id='avaliacao_a_ef_id' class='box' style='text-align: left'>
  <p>matrícula:<input 
    id="avaliacao_a_ef_matricula_id" 
    type="text" 
    pattern="[0-9]{6}" 
    maxlength="6" 
    style="margin:5px"
  ></p>
  <p>avaliação: <select id='avaliacao_a_ef_avaliacao_id' style='margin:5px'>
    <option value='1A'>1A</option>
    <option value='2A'>2A</option>
    <option value='3A'>3A</option>
    <option value='4A'>4A</option>
  </select></p>
  <p>visualizar:<input 
    id="avaliacao_a_ef_button_id" 
    type="button" 
    value="ok" 
    style='margin:5px'
  ></p>
  <p>Terá <span style='color:#ff0000; font-weight:bold'>2 horas</span> para fazer</p>
</div>


<div id='dia_id' class='box'>
  <p>Digite o intervalo de dias (dd/mm/aaaa)</p>
  <p>Início:<input 
    id="dia_i_id" 
    type="text" 
    pattern="[0-9]{2}/[0-9]{2}/[0-9]{4}" 
    maxlength="10" 
    style="margin:5px"
  ></p>
  <p>Final:<input 
    id="dia_f_id" 
    type="text" 
    pattern="[0-9]{2}/[0-9]{2}/[0-9]{4}" 
    maxlength="10" 
    style="margin:5px"
  ></p>
  <br />
  <input 
    id="dia_button" 
    type="button" 
    value="ok" 
  >
</div>
<div id='whatsapp_id' class='box'>
  <p>Digite o número de Whatsapp no formato (##)9.####-####</p>
  <p>Antigo:<input 
    id="whatsapp_antigo_id" 
    type="text" 
    pattern="\([0-9]{2}\)[0-9]\.[0-9]{4}-[0-9]{4}" 
    maxlength="15" 
    style="margin:5px"
  ></p>
  <p>Novo:<input 
    id="whatsapp_novo_id" 
    type="text" 
    pattern="\([0-9]{2}\)[0-9]\.[0-9]{4}-[0-9]{4}" 
    maxlength="15" 
    style="margin:5px"
  ></p>
  <br />
  <input 
    id="whatsapp_button" 
    type="button" 
    value="ok" 
  >
</div>
<div id='email_id' class='box'>
  <p>Digite o endereço de email</p>
  <p>antigo:<input 
    id="email_antigo_id" 
    type="text" 
    style="margin:5px"
  ></p>
  <p>novo:<input 
    id="email_novo_id" 
    type="text" 
    style="margin:5px"
  ></p>
  <br />
  <input 
    id="email_button" 
    type="button" 
    value="ok" 
  >
</div>

<div id='agenda_id' class='box' style='text-align: left'>
  <p>matrícula:<input 
    id="matricula_agenda_id" 
    type="text" 
    pattern="[0-9]{6}" 
    maxlength="6" 
    style="margin:5px"
  ></p>
  <p>disciplina: <select id='disciplina_agenda_id' style='margin:5px'>
    <option value='Selecione'>Selecione</option>
    <option value='POR'>Português</option>
    <option value='ING'>Inglês</option>
    <option value='ART'>Arte</option>
    <option value='MAT'>Matemática</option>
    <option value='HIS'>História</option>
    <option value='GEO'>Geografia</option>
    <option value='FIL'>Filosofia</option>
    <option value='SOC'>Sociologia</option>
    <option value='BIO'>Biologia</option>
    <option value='QUI'>Química</option>
    <option value='FIS'>Física</option>
  </select></p>
  <p>avaliação: <select id='avaliacao_agenda_id' style='margin:5px'>
    <option value='Selecione'>Selecione</option>
    <option value='1A'>1A</option>
    <option value='1B'>1B</option>
    <option value='2A'>2A</option>
    <option value='2B'>2B</option>
    <option value='3A'>3A</option>
    <option value='3B'>3B</option>
  </select></p>
  <p>ver agenda:<input 
    id="button_agenda_id" 
    type="button" 
    value="ok" 
    style='margin:5px'
  ></p>
</div>

<div id='aviso' class='box'>
  <p id='mensagem'></p>
  <input id='aviso_button' type="button" value="ok" onclick="aviso_b()">
</div>

<div id='busca_mat' class='box'>
  <p>Nome completo:<input 
    id="busca_mat_nome" 
    type="text" 
    pattern="\([a-zA-Z ]" 
    maxlength="50"
    minlength="6"
    style="margin:5px"
  ></p>
  <input 
    id="busca_mat_button" 
    type="button" 
    value="ok" 
  >
</div>

<footer style='font-family:"sans-serif"; font-size:10px;'>
<a href='https://tarcisomesquita.github.io/ceejapd/privacidade.html'>Política de privacidade</a><br/>
Autor: <a href='https://tarcisomesquita.github.io/me/'>Tarciso Mesquita</a><br/>
<a rel="license" href="https://creativecommons.org/licenses/by/4.0/deed.pt_BR"><img alt="Licença Creative Commons" style="border-width:0" src="https://tarcisomesquita.github.io/me/CC-BY.png" /></a><br />Esta obra está licenciada com uma Licença <a rel="license" href="http://creativecommons.org/licenses/by/4.0/deed.pt_BR">Creative Commons Atribuição 4.0 Internacional</a>
<footer>
</div><!-- page -->

<div id="agenda_div" style="display:none">
<p style="text-align:center; margin:auto; color:#FF0000">Clique para escolher</p>
<p style="text-align:center; margin:auto; color:limegreen">Em verde, os horários disponíveis</p><br>
<table style="text-align:center; margin:auto">
<tr><th><span class="link" id="agenda_dia_menos" style="font-size: 32px;">&nbsp;&nbsp;&#x21E6;&nbsp;&nbsp;</span> <span id="dia_mes">27/08</span> <span class="link" id="agenda_dia_mais" style="font-size: 32px;">&nbsp;&nbsp;&#x21E8;&nbsp;&nbsp;</span><br><span id="dia_semana">terça-feira</span></th></tr>
<tr><td id="h08">08:00 às 09:00</td></tr>
<tr><td id="h09">09:00 às 10:00</td></tr>
<tr><td id="h10">10:00 às 11:00</td></tr>
<tr><td id="h11">11:00 às 12:00</td></tr>
<tr><td style="color:#FF0000">11:30 às 12:30<br>servimos<br>refeição</td></tr>
<tr><td id="h13">13:05 às 14:00</td></tr>
<tr><td id="h14">14:00 às 15:55</td></tr>
<tr><td id="h15">15:00 às 16:00</td></tr>
<tr><td id="h16">16:00 às 17:00</td></tr>
<tr><td id="h17">17:00 às 18:00</td></tr>
<tr><td style="color:#FF0000">17:30 às 18:30<br>servimos<br>refeição</td></tr>
<tr><td id="h18">18:00 às 19:00</td></tr>
<tr><td id="h19">19:00 às 20:00</td></tr>
<tr><td id="h20">20:00 às 21:00</td></tr>
</table>
<p style="text-align:center"><button id="botao2" style="padding: 14px 40px; background-color:#008CBA; border: 2px solid #f44336; border-radius: 8px; color:white; font-size:20px; font-weight:bold">enviar</button></p>
</div>

<iframe id="hiddenFrame" name="hiddenFrame" style="display:none"></iframe>
<form id="formlog2" style='display:none' enctype="application/x-www-form-urlencoded" action="https://docs.google.com/forms/u/0/d/e/1FAIpQLSeH6hDfEOI6jvgDsdkuuUeah_FU3dPGxZZr-sBBkIjj4Hkwog/formResponse" method="POST" target="hiddenFrame">
<input id="texto" name="entry.667481942" type="hidden">
</form>

<script>
let h_ids = ['h08', 'h09', 'h10', 'h11', 'h13', 'h14', 'h15', 'h16', 'h17', 'h18', 'h19', 'h20'];

let disciplinas_ausentes = {
  'segunda-feira':{
    'h08':["GEO", "FIL", "SOC"], 
    'h09':["GEO", "FIL", "SOC"], 
    'h10':["GEO", "FIL", "SOC"], 
    'h11':["GEO", "FIL", "SOC"], 
    'h13':["GEO", "FIL", "SOC"], 
    'h14':["GEO", "FIL", "SOC"], 
    'h15':["ART", "HIS", "FIL", "QUI", "FIS"], 
    'h16':["ART", "HIS", "FIL", "QUI", "FIS"], 
    'h17':["ART", "HIS", "FIL", "QUI", "FIS"], 
    'h18':["ART", "HIS", "FIL", "QUI", "FIS"], 
    'h19':["ART", "HIS", "FIL", "QUI", "FIS"], 
    'h20':["ART", "HIS", "FIL", "QUI", "FIS"]
  },
  'terça-feira':{
    'h08':["ART", "HIS", "GEO", "FIL", "FIS"], 
    'h09':["ART", "HIS", "GEO", "FIL", "FIS"], 
    'h10':["ART", "HIS", "GEO", "FIL", "FIS"], 
    'h11':["ART", "HIS", "GEO", "FIL", "FIS"], 
    'h13':["ART", "HIS", "GEO", "FIL", "FIS"], 
    'h14':["ART", "HIS", "GEO", "FIL", "FIS"], 
    'h15':["FIL", "SOC", "QUI"], 
    'h16':["FIL", "SOC", "QUI"], 
    'h17':["FIL", "SOC", "QUI"], 
    'h18':["FIL", "SOC", "QUI"], 
    'h19':["FIL", "SOC", "QUI"], 
    'h20':["FIL", "SOC", "QUI"]
  },
  'quarta-feira':{
    'h08':["MAT", "FIL", "SOC", "QUI"], 
    'h09':["MAT", "FIL", "SOC", "QUI"], 
    'h10':["MAT", "FIL", "SOC", "QUI"], 
    'h11':["MAT", "FIL", "SOC", "QUI"], 
    'h13':["MAT", "FIL", "SOC", "QUI"], 
    'h14':["MAT", "FIL", "SOC", "QUI"], 
    'h15':["ART", "HIS", "GEO", "FIL", "FIS"], 
    'h16':["ART", "HIS", "GEO", "FIL", "FIS"], 
    'h17':["ART", "HIS", "GEO", "FIL", "FIS"], 
    'h18':["ART", "HIS", "GEO", "FIL", "FIS"], 
    'h19':["ART", "HIS", "GEO", "FIL", "FIS"], 
    'h20':["ART", "HIS", "GEO", "FIL", "FIS"]
  },
  'quinta-feira':{
    'h08':["ART", "HIS", "FIL", "QUI", "FIS"], 
    'h09':["ART", "HIS", "FIL", "QUI", "FIS"], 
    'h10':["ART", "HIS", "FIL", "QUI", "FIS"], 
    'h11':["ART", "HIS", "FIL", "QUI", "FIS"], 
    'h13':["ART", "HIS", "FIL", "QUI", "FIS"], 
    'h14':["ART", "HIS", "FIL", "QUI", "FIS"], 
    'h15':["GEO", "SOC", "FIL"], 
    'h16':["GEO", "SOC", "FIL"], 
    'h17':["GEO", "SOC", "FIL"], 
    'h18':["GEO", "SOC", "FIL"], 
    'h19':["GEO", "SOC", "FIL"], 
    'h20':["GEO", "SOC", "FIL"]
  },
  'sexta-feira':{
    'h08':["POR", "ING", "ART", "MAT", "HIS", "GEO", "FIL", "SOC", "BIO", "QUI", "FIS", "CIE"], 
    'h09':["FIL"], 
    'h10':["FIL"], 
    'h11':["FIL"], 
    'h13':["POR", "ING", "ART", "MAT", "HIS", "GEO", "FIL", "SOC", "BIO", "QUI", "FIS", "CIE"], 
    'h14':["POR", "ING", "ART", "MAT", "HIS", "GEO", "FIL", "SOC", "BIO", "QUI", "FIS", "CIE"], 
    'h15':["POR", "ING", "ART", "MAT", "HIS", "GEO", "FIL", "SOC", "BIO", "QUI", "FIS", "CIE"], 
    'h16':["POR", "ING", "ART", "MAT", "HIS", "GEO", "FIL", "SOC", "BIO", "QUI", "FIS", "CIE"], 
    'h17':["POR", "ING", "ART", "MAT", "HIS", "GEO", "FIL", "SOC", "BIO", "QUI", "FIS", "CIE"], 
    'h18':["POR", "ING", "ART", "MAT", "HIS", "GEO", "FIL", "SOC", "BIO", "QUI", "FIS", "CIE"], 
    'h19':["POR", "ING", "ART", "MAT", "HIS", "GEO", "FIL", "SOC", "BIO", "QUI", "FIS", "CIE"], 
    'h20':["POR", "ING", "ART", "MAT", "HIS", "GEO", "FIL", "SOC", "BIO", "QUI", "FIS", "CIE"]
  }
};

// = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =

const set_cores = () => {
  for (let i=0; i < h_ids.length; i++) {
    document.getElementById(h_ids[i]).style.backgroundColor = resp_obj.agenda[n_now].horario[h_ids[i]];
  }
}

// = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =

function enviar_escolha() {
  let dia_e = '';
  let hora_e = '';
  for (let i=n_min; i < 10; i++) {
    for (let j=0; j < h_ids.length; j++) {
      if (resp_obj.agenda[i].horario[h_ids[j]] === '#FFFF00') {
        dia_e = resp_obj.agenda[i].dia_mes;
        hora_e = h_ids[j];
      }
    }
  }
  
  if (dia_e === '' && hora_e === '') {
    alert("Clique em um horário para escolhê-lo.");
    return;
  }
  else if (dia_e === dia_old && hora_e === hora_old) {
    alert("O horário escolhido já foi agendado para você.");
    return;
  }
  else {
    botao2.style.visibility = "hidden";
    agenda_div.remove();
    
    let div0 = document.createElement('div');
    div0.setAttribute('id','page');
    div0.innerHTML = '<p class="erro">Aguarde. Marcando na agenda...</p>';
    document.getElementsByTagName('body')[0].appendChild(div0);
    page.style.cursor = 'wait';
    
    fetch('https://script.google.com/macros/s/' + agenda_v + '/exec', {
      method: "POST",
      mode: "cors",
      credentials: "omit",
      headers: {
        "Content-Type": "text/plain"
      },
      body: '{"tipo":"2", "matricula":"' + matricula + '", "disciplina":"' + disciplina + '", "avaliacao":"' + avaliacao + '", "usuario":"' + usuario + '", "token":"' + token + '", "escolha":{"dia":"' + dia_e + '","hora":"' + hora_e + '"}, "escolha_old":{"dia":"' + dia_old + '","hora":"' + hora_old + '"}}'
    })
    .then(response => response.text())
    .then(value => { resp_obj = JSON.parse(value); console.log(resp_obj); fetch_resposta();})
//    .then(response => {resp_obj = response.json(); console.log(resp_obj); fetch_resposta();})
    .catch((error) => {
      console.error("Catch2:", error);
      page.innerHTML = '<p class="erro">Aguarde. Marcando na agenda...</p>';
      page.style.cursor = 'auto';
      informe('ERRO: ceejapd: load agenda_escolha: ' + usuario + ': ' + error);
    });
  }
  return;
}

// = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =

function marcar(h_id) {
  if (document.getElementById(h_id).style.backgroundColor === "rgb(170, 170, 170)") return;
  
  for (let i = 0; i < h_ids.length; i++) {
    if (
    document.getElementById(h_ids[i]).style.backgroundColor === "#FFFF00" ||
    document.getElementById(h_ids[i]).style.backgroundColor === "rgb(255, 255, 0)" ||
    document.getElementById(h_ids[i]).style.backgroundColor === "yellow") document.getElementById(h_ids[i]).style.backgroundColor = "limegreen";
  }
  
  document.getElementById(h_id).style.backgroundColor = "yellow";
  
  for (let i=n_min; i < 10; i++) {
    for (let j=0; j < h_ids.length; j++) {
      if (resp_obj.agenda[i].horario[h_ids[j]] === '#FFFF00') resp_obj.agenda[i].horario[h_ids[j]] = '#32CD32';
    }
  }
  resp_obj.agenda[n_now].horario[h_id] = '#FFFF00';
}

// = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =

function fetch_erro(mensagem) {
  document.getElementById('page').remove();
  
  let p0 = document.createElement('p');
  p0.setAttribute('class','erro');
  p0.innerHTML = mensagem;
  document.getElementsByTagName('body')[0].appendChild(p0);
}

// = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =

let dia_old = '';
let hora_old = '';

function fetch_resposta() {
  //console.log(resp_obj);
  
  if (resp_obj.erro !== '') {fetch_erro(resp_obj.erro); return;}
  if (resp_obj.token !== '') {
    document.cookie = `ceejapd=${resp_obj.token};expires=2021-12-25T00:00:00.000Z;path=/ceejapd/;`;
    document.cookie = `usuario=${usuario};expires=2021-12-25T00:00:00.000Z;path=/ceejapd/;`;
    console.log(document.cookie);
  }
  
  page.remove();
  agenda_div.style.display = 'inline';
  
  agenda_dia_mais.onclick = () => {
    if (n_now < 9) {
      n_now++;
      dia_mes.innerText = resp_obj.agenda[n_now].dia_mes;
      dia_semana.innerText = resp_obj.agenda[n_now].dia_semana;
      set_cores();
    }
  }
  
  agenda_dia_menos.onclick = () => {
    if (n_now > n_min) {
      n_now--;
      dia_mes.innerText = resp_obj.agenda[n_now].dia_mes;
      dia_semana.innerText = resp_obj.agenda[n_now].dia_semana;
      set_cores();
    }
  }
  
  for (let i = 0; i < h_ids.length; i++) {
    document.getElementById(h_ids[i]).setAttribute("onclick","marcar('" + h_ids[i] + "')");
  }
  
  document.getElementById("botao2").setAttribute("onclick","enviar_escolha()");
  
  let hoje = ds.substring(0,5);
  
  if (dia_s == 6 || dia_s == 0) {
    n_min = 5;
  }
  else {
    for (let i=0; i<10; i++) {
      if (resp_obj.agenda[i].dia_mes === hoje) {
        n_min = i;
        break;
      };
    }
  }
  n_now = n_min;
  
  for (let i=n_min; i < 10; i++) {
    for (let j=0; j < h_ids.length; j++) {
      let nao_tem = (disciplinas_ausentes[resp_obj.agenda[i].dia_semana])[h_ids[j]];
      if (nao_tem.indexOf(disciplina) != -1) resp_obj.agenda[i].horario[h_ids[j]] = '#AAAAAA';
    }
    
    if (disciplina === 'QUI' && resp_obj.agenda[i].dia_mes === '17/09') {
      resp_obj.agenda[i].horario['h10'] = '#AAAAAA';
      resp_obj.agenda[i].horario['h11'] = '#AAAAAA';
    }
    
    if (disciplina === 'FIS' && resp_obj.agenda[i].dia_mes === '15/09') {
      resp_obj.agenda[i].horario['h13'] = '#AAAAAA';
      resp_obj.agenda[i].horario['h14'] = '#AAAAAA';
    }
    
    if (disciplina === 'FIS' && resp_obj.agenda[i].dia_mes === '22/09') {
      resp_obj.agenda[i].horario['h13'] = '#AAAAAA';
      resp_obj.agenda[i].horario['h14'] = '#AAAAAA';
    }
    
    if (disciplina === 'FIS' && resp_obj.agenda[i].dia_mes === '29/09') {
      resp_obj.agenda[i].horario['h13'] = '#AAAAAA';
      resp_obj.agenda[i].horario['h14'] = '#AAAAAA';
    }
  }
  
  if (dia_s > 0 && dia_s < 6) {
    let hora_str = ds.substring(11,13);
    for (let i=0; i < h_ids.length; i++) {
      if (h_ids[i] === `h${hora_str}`) {
        for (let j=0; j < (i + 2) && j < h_ids.length; j++) {
          resp_obj.agenda[n_min].horario[h_ids[j]] = '#AAAAAA';
        }
        break;
      } 
    }
  }
  
  for (let i=n_min; i < 10; i++) {
    for (let j=0; j < h_ids.length; j++) {
      if (resp_obj.agenda[i].horario[h_ids[j]] === '#FFFF00') {
        dia_old = resp_obj.agenda[i].dia_mes;
        hora_old = h_ids[j];
      }
    }
  }
  
  dia_mes.innerText = resp_obj.agenda[n_now].dia_mes;
  dia_semana.innerText = resp_obj.agenda[n_now].dia_semana;
  set_cores();
}

let ds = (new Date()).toLocaleString("pt-BR", {"timeZone": "America/Sao_Paulo"});
let agora = new Date(Date.parse(ds.replace(/^([0-9]{2})\/([0-9]{2})\/([0-9]{4}) (.*)/, "$3-$2-$1T$4.000Z"))); // Data with timezone
let dia_s = agora.getDay();
let hora = agora.getUTCHours();
let dia_m = agora.getDate();

let n_min = 0;
let n_now = 0;

// = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =

agenda.onclick = () => {
  if (token === '') {
    aviso('ERRO: Precisa fazer login.\n\nToque no botão azul na primeira linha.');
    return;
  }
  
  container.style.display = 'inline';
  agenda_id.style.display = 'inline';
  matricula_agenda_id.value = matricula; 
  disciplina_agenda_id.innerHTML = '';
  avaliacao_agenda_id.innerHTML = '';
  
  matricula_agenda_id.focus();
  
  matricula_agenda_id.onkeyup = function () {
    if (/^[0-9]{6}$/.test(matricula_agenda_id.value)){
      matricula = matricula_agenda_id.value;
      disciplina_agenda_id.focus();
    }
  }
  
  disciplina_agenda_id.onfocus = function () {
    if (disciplina_agenda_id.innerHTML !== '') return;
    
    if (! /^[0-9]{6}$/.test(matricula_agenda_id.value)) {
      matricula_agenda_id.focus();
      return;
    }
    
    if (matricula.charAt(2) === '1') {
      disciplina_agenda_id.innerHTML = '\n' +
        '    <option value="Selecione">Selecione</option>\n' + 
        '    <option value="POR">Português</option>\n' + 
        '    <option value="ING">Inglês</option>\n' + 
        '    <option value="ART">Arte</option>\n' + 
        '    <option value="MAT">Matemática</option>\n' + 
        '    <option value="HIS">História</option>\n' + 
        '    <option value="GEO">Geografia</option>\n' + 
        '    <option value="CIE">Ciências</option>\n';
    }
    else {
      disciplina_agenda_id.innerHTML = '\n' +
        '    <option value="Selecione">Selecione</option>\n' + 
        '    <option value="POR">Português</option>\n' + 
        '    <option value="ING">Inglês</option>\n' + 
        '    <option value="ART">Arte</option>\n' + 
        '    <option value="MAT">Matemática</option>\n' + 
        '    <option value="HIS">História</option>\n' + 
        '    <option value="GEO">Geografia</option>\n' + 
        '    <option value="FIL">Filosofia</option>\n' + 
        '    <option value="SOC">Sociologia</option>\n' + 
        '    <option value="BIO">Biologia</option>\n' + 
        '    <option value="QUI">Química</option>\n' + 
        '    <option value="FIS">Física</option>\n';
    }
    disciplina_agenda_id.value = 'Selecione';
  }
  
  disciplina_agenda_id.onchange = function () {
    avaliacao_agenda_id.innerHTML = '';
    if (disciplina_agenda_id.value === 'Selecione') disciplina_agenda_id.focus();
    else {
      disciplina = disciplina_agenda_id.value;
      avaliacao_agenda_id.focus();
    }
  }
  
  avaliacao_agenda_id.onfocus = function () {
    if (avaliacao_agenda_id.innerHTML !== '') return;
    
    if (! /^[A-Z]{3}$/.test(disciplina_agenda_id.value)) {
      disciplina_agenda_id.focus();
      return;
    }
    
    if (matricula.charAt(2) === '1') {
      if (disciplina === 'POR' || disciplina === 'MAT') {
        avaliacao_agenda_id.innerHTML = '\n' +
          '    <option value="Selecione">Selecione</option>\n' + 
          '    <option value="1A">1A</option>\n' + 
          '    <option value="1B">1B</option>\n' + 
          '    <option value="2A">2A</option>\n' + 
          '    <option value="2B">2B</option>\n' + 
          '    <option value="3A">3A</option>\n' + 
          '    <option value="3B">3B</option>\n' + 
          '    <option value="4A">4A</option>\n' + 
          '    <option value="4B">4B</option>\n';
        if (disciplina === 'POR') avaliacao_agenda_id.innerHTML = avaliacao_agenda_id.innerHTML + '    <option value="R">R</option>\n';
      }
      else {
        avaliacao_agenda_id.innerHTML = '\n' +
          '    <option value="Selecione">Selecione</option>\n' + 
          '    <option value="1A">1A</option>\n' + 
          '    <option value="2A">2A</option>\n' + 
          '    <option value="3A">3A</option>\n' + 
          '    <option value="4A">4A</option>\n';
        if (disciplina === 'CIE') avaliacao_agenda_id.innerHTML = avaliacao_agenda_id.innerHTML + '    <option value="4B">4B</option>\n';
        if (disciplina === 'ART' || disciplina === 'ING') avaliacao_agenda_id.innerHTML = avaliacao_agenda_id.innerHTML + '    <option value="5A">5A</option>\n';
      }
    }
    else {
      if (
        disciplina === 'ART' ||
        disciplina === 'GEO' ||
        disciplina === 'SOC' ||
        disciplina === 'BIO' ||
        disciplina === 'QUI'
      ) {
        avaliacao_agenda_id.innerHTML = '\n' +
          '    <option value="Selecione">Selecione</option>\n' + 
          '    <option value="1A">1A</option>\n' + 
          '    <option value="2A">2A</option>\n' + 
          '    <option value="3A">3A</option>\n';
        if (disciplina === 'BIO') avaliacao_agenda_id.innerHTML = avaliacao_agenda_id.innerHTML + '    <option value="3B">3B</option>\n';
        if (disciplina === 'ART') avaliacao_agenda_id.innerHTML = avaliacao_agenda_id.innerHTML + '    <option value="4A">4A</option>\n';
      }
      else {
        avaliacao_agenda_id.innerHTML = '\n' + 
          '    <option value="Selecione">Selecione</option>\n' + 
          '    <option value="1A">1A</option>\n' + 
          '    <option value="1B">1B</option>\n' + 
          '    <option value="2A">2A</option>\n' + 
          '    <option value="2B">2B</option>\n' + 
          '    <option value="3A">3A</option>\n' + 
          '    <option value="3B">3B</option>\n';
        if (disciplina === 'POR') avaliacao_agenda_id.innerHTML = avaliacao_agenda_id.innerHTML + '    <option value="R">R</option>\n';
        if (disciplina === 'ING') avaliacao_agenda_id.innerHTML = avaliacao_agenda_id.innerHTML + '    <option value="3C">3C</option>\n';
      }
    }
    avaliacao_agenda_id.value = 'Selecione';
  }
  
  avaliacao_agenda_id.onchange = function () {
    if (avaliacao_agenda_id.value === 'Selecione') avaliacao_agenda_id.focus();
    else {
      avaliacao = avaliacao_agenda_id.value;
      button_agenda_id.focus();
    }
  }
  
  button_agenda_id.onclick = function () {
    if (! /[0-9]{6}/.test(matricula_agenda_id.value)){ matricula_agenda_id.focus(); return; }
    if (disciplina_agenda_id.value === 'Selecione' || disciplina_agenda_id.value === '') { disciplina_agenda_id.focus(); return; }
    if (avaliacao_agenda_id.value === 'Selecione' || avaliacao_agenda_id.value === '') { avaliacao_agenda_id.focus(); return; }
    
    page.innerHTML = '<p class="erro">Aguarde 1 minuto. Baixando a agenda ...</p>';
    page.style.cursor = 'wait';
    
    informe(`agenda: ${matricula}: ${disciplina}: ${avaliacao}: ${usuario}`);
    
    fetch('https://script.google.com/macros/s/' + agenda_v + '/exec', {
      method: "POST",
      mode: "cors",
      credentials: "omit",
      headers: {
        "Content-Type": "text/plain"
      },
      body: '{"tipo":"1", "matricula":"' + matricula + '", "disciplina":"' + disciplina + '", "avaliacao":"' + avaliacao + '", "usuario":"' + usuario + '", "token":"' + token + '"}'
    })
    .then(response => response.text())
    .then(value => { resp_obj = JSON.parse(value); console.log(resp_obj); fetch_resposta();})
//    .then(response => {resp_obj = response.json(); console.log(resp_obj); fetch_resposta();})
    .catch((error) => {
      console.error("Catch1:", error);
      document.getElementsByTagName('body')[0].innerHTML = '<p class="erro">ERRO ao carregar. Informe o professor.</p>';
      informe('ERRO: ceejapd: load agenda: ' + usuario + ': ' + error);
    });
  }
}

// = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =

function resposta_busca_mat() {
  if (resp_obj.token !== '') {
    document.cookie = `ceejapd=${resp_obj.token};expires=2021-12-25T00:00:00.000Z;path=/ceejapd/;`;
    document.cookie = `usuario=${usuario};expires=2021-12-25T00:00:00.000Z;path=/ceejapd/;`;
    console.log(document.cookie);
  }
  
  page.remove();
  
  let p0 = document.createElement('p');
  p0.setAttribute('class','erro');
  p0.innerHTML = resp_busca_mat_obj.msg;
  document.getElementsByTagName('body')[0].appendChild(p0);
}

// = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =

busca_matricula.onclick = () => {
  if (token === '') {
    aviso('ERRO: Precisa fazer login.\n\nToque no botão azul na primeira linha.');
    return;
  }
  
  container.style.display = 'inline';
  busca_mat.style.display = 'inline';
  
  busca_mat_nome.focus();
  
  busca_mat_nome.onkeyup = function () {
    if (event.keyCode == 13) button_agenda_id.focus();
  }
  
  busca_mat_button.onclick = function () {
    if (
      busca_mat_nome.value.length < 6 || 
      busca_mat_nome.value.length > 50 
    ) {busca_mat_nome.focus(); return;}
    
    fetch('https://script.google.com/macros/s/' + busca_matricula_v + '/exec', {
      method: "POST",
      mode: "cors",
      credentials: "omit",
      headers: {
        "Content-Type": "text/plain"
      },
      body: '{"nome":"' + busca_mat_nome.replace(/'/g, '').value.toUpperCase() + '", "usuario":"' + usuario + '", "token":"' + token + '"}'
    })
    .then(response => response.text())
    .then(value => { resp_busca_mat_obj = JSON.parse(value); console.log(resp_busca_mat_obj); resposta_busca_mat();})
    .catch((error) => {
      console.error("Catch_busca_matricula:", error);
      document.getElementsByTagName('body')[0].innerHTML = '<p class="erro">ERRO ao carregar. Informe o professor.</p>';
      informe('ERRO: ceejapd: busca_matricula: ' + usuario + ': ' + error);
    });
}
  
// = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =

let piscar = setInterval(function() {
  if (agenda.style.color === 'rgb(221, 68, 51)') agenda.style.color = 'rgb(33, 96, 222)';
  else agenda.style.color = 'rgb(221, 68, 51)';
}, 500);

setTimeout(function () {
  clearInterval(piscar);
  agenda.style.color = '#22BB22';
}, 2000); // 2 s 


if ((dia_s == 6 || dia_s == 0) || (dia_s == 5 && hora > 22)) avaliacoes.style.display = 'none';
//else if (dia_m == 6 || dia_m == 7 || (dia_m == 5 && hora > 22) avaliacoes.style.display = 'none';

/*
 
fetch('https://worldtimeapi.org/api/America/Sao_Paulo')
.then(function(response) {
  let contentType = response.headers.get("content-type");
  if (contentType && contentType.indexOf("application/json") !== -1) {
    return response.json();
  }
  else {
    informe('ERRO: Not got JSON | usuário: ' + usuario);
  }
})
.then(function(json) {
      informe('usuário: ' + usuario + ' | ip: ' + json.client_ip);
});
*/
</script>
</body>
</html>
