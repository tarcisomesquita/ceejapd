<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<meta viewport='width=device-width, initial-scale=1' />

<title>PD</title>

<script>
// https://bit.ly/e3289

let scriptId = 'AKfycbx-PXmiOfQNDvdF0BCDjRvXaY1TsQAR5Y8sKBblGo5r9zXghSb-wolLSS68J3VaqUUJgA'; // v17 HIS
//let scriptId = 'AKfycbwSRbq4zmZhTI2h8ExZphTfY8IKCkh58uKBjZOsGQDqLhvZyGzMc2JSpZDQxK-4pLrxBQ'; // v16 oficina
//let scriptId = 'AKfycbw3A2WoA1u1d2DAG0b4Jl__6hEdJceKTWvEypESBmXF__8ip_5aFGNvz9-BRHb8ZClpZg'; // v15 refazer av
//let scriptId = 'AKfycbwy0wZRbnnaqn_5rdZ7w7hnPKtyNBML6B9hFOQrPc41s9vtzGHmeaoMKTiRqChjrH8N2g'; // v14 disciplina
//let scriptId = 'AKfycbwDZo_vBa0Cufv_ehbi6zpCu9843PmBpg1QI4xQza7P89SvPmaLNc9IePhJiilrVOdH4A'; // v13 av_ger e gr_prof
//let scriptId = 'AKfycbx1Q-eBz1t-Zv4l8S58jEnzoZyTKFVQgF1CpWRbo32XuwonRXysqGJUBLSmNTbxz4h29Q'; // v12

let auth2;
let googleUser;

let usuario = '';
let token = '';

function getCookie(cname) {
  let name = cname + "=";
  let ca = document.cookie.split(';');
  for(let i = 0; i < ca.length; i++) {
    let c = ca[i];
    while (c.charAt(0) == ' ') c = c.substring(1);
    if (c.indexOf(name) == 0) {
      return c.substring(name.length, c.length);
    }
  }
  return '';
}

token = getCookie("ceejapd");
usuario = getCookie("usuario");

if (token === '') {
  let s = document.createElement('script');
  s.src = 'https://apis.google.com/js/api:client.js';
  document.head.appendChild(s);
}

let startApp = () => {
  if (token === '') {
    gapi.load('auth2', initSignIn);
  }
  else {
    document.getElementById('customBtn').style.display = 'none';
    document.getElementById('bmail').style.display = 'block';
    document.getElementById('mail').innerText = usuario;
    window.location.href = `https://script.google.com/macros/s/${scriptId}/exec?usuario=${usuario}&token=${token}`;
    //window.location.href = `https://script.google.com/macros/s/AKfycbzqvJ8oZ05VhERVUOi93Jf8CSzrzsRfePJDkRxYe0ek/dev?usuario=${usuario}&token=${token}`;
  }
};

let initSignIn = () => {
  auth2 = gapi.auth2.init({client_id: '424899238646-9rov4v21n8936trraugrl3vcb3cs54id.apps.googleusercontent.com', scope:'profile email'});
  
  auth2.attachClickHandler(document.getElementById('customBtn'), {}, null, null);
  
  auth2.isSignedIn.listen(signinChanged);

  if (auth2.isSignedIn.get() == true) {
    auth2.signIn();
  }
};

let signinChanged = (val) => {
  if (val) {
    token = auth2.currentUser.get().getAuthResponse().id_token;
    usuario = auth2.currentUser.get().getBasicProfile().getEmail();
    
    document.getElementById('customBtn').style.display = 'none';
    document.getElementById('bmail').style.display = 'block';
    document.getElementById('mail').innerText = usuario;
    window.location.href = `https://script.google.com/macros/s/${scriptId}/exec?usuario=${usuario}&token=${token}`;
    //window.location.href = `https://script.google.com/macros/s/AKfycbzqvJ8oZ05VhERVUOi93Jf8CSzrzsRfePJDkRxYe0ek/dev?usuario=${usuario}&token=${token}`;
  }
  else {
    token = '';
    usuario = '';
    document.getElementById('bmail').style.display = 'none';
    document.getElementById('customBtn').style.display = 'inline';
  }
};

let sair = () => {
  document.cookie = "ceejapd=;expires=1970-01-01T00:00:00.000Z;path=/ceejapd/;";
  document.cookie = "usuario=;expires=1970-01-01T00:00:00.000Z;path=/ceejapd/;";
  if (auth2 == undefined) location.reload();
  else { auth2.signOut(); location.reload();}
};
</script>

<style>
body {
  height: 100%;
  background-color: #FFFFFF;
  font-family: 'Open Sans',sans-serif;
  color: #000000;
  font-size: 16px;
  line-height: 23px;
  text-align: justify;
  margin: 0px;
  padding: 5mm;
}

#customBtn {
  display: inline-block;
  background: #1a73e8;
  color: #ffffff;
  border: 1px solid transparent;
  font-size: 16px;
  line-height: 23px;
  margin-left: 10px;
  margin-right: 8px;
  min-width: 96px;
  padding: 9px 23px;
  text-align: center;
  vertical-align: middle;
  -moz-border-radius: 4px;
  border-radius: 4px;
  box-sizing: border-box;
}

#customBtn:hover {
  cursor: pointer;
}
</style>
</head>

<body onload='startApp()'>

<p>Para acessar os serviços do CEEJA Paulo Decourt, deve fazer login na Google.</p>

<br />

<div id="customBtn" class="customBtn">Fazer login</div>
<p id="bmail" style="display:none">Usuário: <span id="mail" style='color:#DD4433'></span>
  <span onclick="sair();" style="background:#cccccc;border: 1px solid #000000; margin-left:10px; margin-right:8px; min-width:96px; padding: 9px 23px; text-align:center; vertical-align:middle; -moz-border-radius:4px; border-radius:4px; box-sizing: border-box; cursor:pointer;">Sair</span>
</p>

<br />
<br />
<br />
<br />

<p>Acesse nossas redes sociais:</p>

<p><a href="https://facebook.com/ceejapaulodecourt" target="_blank"><img src="https://github.com/tarcisomesquita/ceejapd/raw/4cb5b97fb0f430a98526060ead1263b660d94c23/imagens/facebook.png"> Facebook</a></p>

<p><a href="https://instagram.com/ceeja.paulo.decourt" target="_blank"><img src="https://github.com/tarcisomesquita/ceejapd/raw/4cb5b97fb0f430a98526060ead1263b660d94c23/imagens/instagran.png"> Instagram</a></p>

<p><a href="https://www.youtube.com/channel/UCaugpxhjj2F7aOfbG4k3TFQ/videos" target="_blank"><img src="https://raw.githubusercontent.com/tarcisomesquita/ceejapd/4cb5b97fb0f430a98526060ead1263b660d94c23/imagens/youtube.png"> Youtube</a></p>

<br />
<br />
<br />
<br />

<p><a href="https://tarcisomesquita.github.io/ceejapd/CEEJAs.html" target="_blank">Outros CEEJAs</a></p>

<footer style='font-family:"sans-serif"; font-size:10px;'>
<a href="https://tarcisomesquita.github.io/ceejapd/privacidade.html" target="_blank">Política de privacidade</a><br/>
Autor: <a href="https://tarcisomesquita.github.io/me/" target="_blank">Tarciso Mesquita</a><br/>
<a rel="license" href="https://creativecommons.org/licenses/by/4.0/deed.pt_BR" target="_blank"><img alt="Licença Creative Commons" style="border-width:0" src="https://tarcisomesquita.github.io/me/CC-BY.png" /></a><br />Esta obra está licenciada com uma Licença <a rel="license" href="http://creativecommons.org/licenses/by/4.0/deed.pt_BR" target="_blank">Creative Commons Atribuição 4.0 Internacional</a>
<footer>

</body>
</html>
